<%= form_with url: root_path, method: :get, local: true, class: 'filters' do |f| %>
  <input type="text" name="q" value="<%= params[:q] %>" placeholder="Search identifier..." style="min-width: 220px;">
  <select name="status">
    <option value="">All statuses</option>
    <option value="success" <%= params[:status] == 'success' ? 'selected' : '' %>>Success</option>
    <option value="error" <%= params[:status] == 'error' ? 'selected' : '' %>>Error</option>
  </select>
  <select name="kind">
    <option value="">All kinds</option>
    <option value="sidekiq" <%= params[:kind] == 'sidekiq' ? 'selected' : '' %>>Sidekiq</option>
    <option value="request" <%= params[:kind] == 'request' ? 'selected' : '' %>>Request</option>
    <option value="custom" <%= params[:kind] == 'custom' ? 'selected' : '' %>>Custom</option>
  </select>
  <button type="submit">Filter</button>
<% end %>

<div class="card traces-list">
  <% if @traces.any? %>
    <% @traces.each do |trace| %>
      <%= link_to trace_path(trace.id), class: 'trace-row trace-row-link' do %>
        <span class="trace-id"><%= trace.id %></span>
        <span class="trace-identifier"><%= trace.identifier %></span>
        <span class="badge <%= trace.status == :success ? 'badge-success' : 'badge-error' %>"><%= trace.status %></span>
        <span class="trace-duration"><%= trace.duration_ms ? "#{trace.duration_ms.round}ms" : '-' %></span>
        <span class="trace-timestamp" title="<%= trace_started_at_formatted(trace) %>"><%= trace_started_at_short(trace) %></span>
      <% end %>
    <% end %>
  <% else %>
    <p class="empty">No traces found. Run your app and execute some jobs or requests.</p>
  <% end %>
</div>
